####### Query 1 Question: What are the top 5 countries in which maximum no. of f1 races took place?

SELECT epl.Country, COUNT(*) AS NumberOfRaces
FROM `finalproject.f1_race` epl
GROUP BY Country
ORDER BY NumberOfRaces DESC
LIMIT 5;


####### Query 2 Question: Find the corelation between no. of players and the average gdp of the country. Is there any positive/negative relationship
##Answer -After you run the query, based on output -  The positive sign indicates that as player count tends to increase, average GDP also tends to increase slightly.The value of 0.15 suggests that the relationship between player count and average GDP is quite weak.In practical terms, this means that there isn't a strong connection between the number of players in a country and its economic performance, as measured by GDP.

WITH player_gdp_stats AS (
    SELECT 
        epl.country_name AS Country, 
        COUNT(display_name) AS Player_Count,
        AVG(GDP_Value) AS Avg_GDP
    FROM 
        `finalproject.epl_country` epl
    JOIN 
        `finalproject.gdp_country` gdp
    ON 
        epl.birth_year = gdp.year AND epl.country_name = gdp.country_name
    GROUP BY 
        epl.country_name
    ORDER BY 
        Player_Count DESC
)
SELECT 
    CORR(Player_Count, Avg_GDP) AS Correlation
FROM 
    player_gdp_stats;


####### Query 3 Question: Find the average age of players from each country and also keep a track of how many players are being considered to calculate average (for each country) in the result.

SELECT 
    epl.country_name AS Country,
    COUNT(*) AS Player_Count,
    AVG(EXTRACT(YEAR FROM CURRENT_DATE()) - birth_year) AS Avg_Age

FROM 
    `finalproject.epl_country` epl
GROUP BY 
    country_name
ORDER BY 
    Player_Count DESC;

####### Query 4 Question: Populate country to year matrix showing how many races happened in each country over the years?

SELECT 
    Country,
    SUM(CASE WHEN Year = 2005 THEN 1 ELSE 0 END) AS Races_2005,
    SUM(CASE WHEN Year = 2006 THEN 1 ELSE 0 END) AS Races_2006,
    SUM(CASE WHEN Year = 2007 THEN 1 ELSE 0 END) AS Races_2007,
    SUM(CASE WHEN Year = 2008 THEN 1 ELSE 0 END) AS Races_2008,
    SUM(CASE WHEN Year = 2009 THEN 1 ELSE 0 END) AS Races_2009,
    SUM(CASE WHEN Year = 2010 THEN 1 ELSE 0 END) AS Races_2010,
    SUM(CASE WHEN Year = 2011 THEN 1 ELSE 0 END) AS Races_2011,
    SUM(CASE WHEN Year = 2012 THEN 1 ELSE 0 END) AS Races_2012,
    SUM(CASE WHEN Year = 2013 THEN 1 ELSE 0 END) AS Races_2013,
    SUM(CASE WHEN Year = 2014 THEN 1 ELSE 0 END) AS Races_2014,
    SUM(CASE WHEN Year = 2015 THEN 1 ELSE 0 END) AS Races_2015,
    SUM(CASE WHEN Year = 2016 THEN 1 ELSE 0 END) AS Races_2016,
    SUM(CASE WHEN Year = 2017 THEN 1 ELSE 0 END) AS Races_2017,
    SUM(CASE WHEN Year = 2018 THEN 1 ELSE 0 END) AS Races_2018,
    SUM(CASE WHEN Year = 2019 THEN 1 ELSE 0 END) AS Races_2019,
    SUM(CASE WHEN Year = 2020 THEN 1 ELSE 0 END) AS Races_2020,
    SUM(CASE WHEN Year = 2021 THEN 1 ELSE 0 END) AS Races_2021,
    SUM(CASE WHEN Year = 2022 THEN 1 ELSE 0 END) AS Races_2022

FROM `finalproject.f1_race`
GROUP BY Country
ORDER BY Country;




